(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[460],{88222:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dip/node/[key]",function(){return s(91426)}])},61253:function(e,t,s){"use strict";s.d(t,{s:function(){return r}});var l=s(85893),a=s(45332),n=s(3247),i=s(75396);let r=e=>{let{mint:t,amount:s}=e,{token:r}=(0,n.Z)(t),{map:d}=(0,i.Z)(),c=null==d?void 0:d.get(t.toString());return(0,l.jsx)("div",{className:"font-bold",children:r?(0,l.jsxs)("div",{className:"flex flex-row",children:[(0,a.Bw)(s,r.decimals).toFixed(2)," ",c?(0,l.jsx)("div",{className:"tooltip my-auto","data-tip":c.name,children:(0,l.jsx)("img",{src:c.logoURI,className:"w-5 h-5 rounded-full"})}):(0,a.sC)(t)]}):null})}},44065:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var l=s(60731),a=s(67294);function n(){return(0,a.useContext)(l.C)}},3247:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var l=s(44777),a=s(67294),n=s(44718);function i(e){let{connection:t}=(0,n.R)(),[s,i]=(0,a.useState)(),r=async()=>{if(t&&e)try{let s=await (0,l.ih)(t,e);i(s)}catch(a){}};return(0,a.useEffect)(()=>{r()},[e]),{token:s}}},75396:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var l=s(81189),a=s(67294);function n(){let{tokenMap:e,tokenNames:t}=(0,a.useContext)(l.Q);return{map:e,names:t}}},91426:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return L}});var l=s(85893),a=s(9008),n=s.n(a),i=s(63750),r=s(64949),d=s(67294),c=s(54306),o=s(44718),u=s(79286),x=s(49836),h=s(86501),m=s(44065),v=s(23286),f=e=>{let{node:t,onCreate:s}=e,a=(0,c.O)(),n=(0,v.Z)(),{connection:f}=(0,o.R)(),{program:p,forest:j}=(0,m.Z)(),[g,b]=(0,d.useState)(!1),[N,w]=(0,d.useState)(),[y,k]=(0,d.useState)(!1),C=e=>{w(e.target.value)},S=async()=>{if(!n||!p||!j||!t||!N)return;k(!0);let e=(0,r.vh)(t.tree,t.parent,t.tags[t.tags.length-1]),l=new x.Transaction;l.add(await p.methods.createNode(N).accounts((0,r.so)(u.VO,t.tree,e,N,p.provider.publicKey)).instruction()),t.children.length<r.D&&l.add(await p.methods.attachNode().accounts((0,r.ed)(u.VO,t.tree,e,(0,r.vh)(t.tree,e,N),p.provider.publicKey)).instruction());try{await f.confirmTransaction(await a.sendTransaction(l,f,{skipPreflight:!0})),s&&s()}catch(i){h.Am.error(i.toString())}finally{k(!1)}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"w-64 bg-base-100 hover:bg-base-200 transition-all border-2 border-base-200 rounded-xl shadow-inner hover:shadow-xl p-6 m-3 flex flex-col",onClick:()=>b(!0),children:(0,l.jsxs)("div",{className:"m-auto",children:[(0,l.jsx)(i.h2i,{className:"w-20 h-20 m-auto"}),(0,l.jsx)("div",{className:"text-2xl text-center",children:"Create node"})]})}),(0,l.jsx)("div",{className:"modal ".concat(g?"modal-open":""),children:(0,l.jsxs)("div",{className:"modal-box flex flex-col gap-2 max-w-3xl bg-base-300 align-center p-3 rounded-xl shadow-xl mx-auto",children:[(0,l.jsx)("div",{className:"btn btn-sm btn-circle fixed right-2 top-2 absolute",onClick:()=>b(!1),children:"✕"}),(0,l.jsx)("div",{className:"text-xl font-bold",children:"Tag"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm",children:"The tag of the child node."}),(0,l.jsx)("div",{className:"text-sm",children:"A node inherits all his tags from its parent"})]}),(0,l.jsx)("input",{className:"input input-bordered w-full",placeholder:"Tag...",onChange:C}),(0,l.jsx)("div",{className:"btn btn-primary ".concat(N?"":"btn-disabled"," ").concat(y?"btn-disabled loading":""),onClick:S,children:"Create a child"})]})})]})},p=s(8193),j=s(82921),g=s(33787),b=s.n(g),N=s(8523),w=e=>{let{node:t,onCreate:s}=e,a=(0,c.O)(),{connection:n}=(0,o.R)(),{program:i,forest:v}=(0,m.Z)(),[f,g]=(0,d.useState)(!1),[w,y]=(0,d.useState)(),[k,C]=(0,d.useState)(),[S,Z]=(0,d.useState)(),[T,K]=(0,d.useState)(),[M,A]=(0,d.useState)(),[D,E]=(0,d.useState)(),[O,F]=(0,d.useState)(!1),_=(0,d.useCallback)(async e=>{if(!n)return;if(e.length>1){h.Am.error("Upload only a single image");return}let t=new j.WebBundlr("https://devnet.bundlr.network","solana",a,{providerUrl:n.rpcEndpoint});try{let s=await t.fund(await t.getPrice(Math.round(1.1*e[0].size)));console.log(s)}catch(l){A(l.toString());return}let i=t.uploader.chunkedUploader;i.setBatchSize(2),i.setChunkSize(2e6);try{var r;let d=await i.uploadData(b()(e[0]),{tags:[{name:"Content-Type",value:null!==(r=e[0].type)&&void 0!==r?r:"application/octet-stream"}]});console.log(d),(null==d?void 0:d.status)===200||(null==d?void 0:d.status)===201?(h.Am.success("Successful!"),K("https://arweave.net/".concat(d.data.id))):h.Am.error("Unsuccessful")}catch(c){h.Am.error("Failed to upload - ".concat(c))}},[]),{getRootProps:B,getInputProps:P,isDragActive:R}=(0,N.uI)({onDrop:_,multiple:!1,accept:{"application/octet-stream":[".jpg",".png"]}}),V=e=>{y(e.target.value)},I=e=>{C(e.target.value)},U=e=>{Z(e.target.value)},z=e=>{E(e.target.value)},X=async()=>{if(!i||!i.provider.publicKey||!v||!t||!w||!k||!(S||T)||!D)return;F(!0);let e=x.Keypair.generate().publicKey,l=(0,r.El)(t.tree,e),a=(0,r.vh)(t.tree,t.parent,t.tags[t.tags.length-1]);try{await i.methods.createNote(e,w,k,T||S,D).accounts((0,r.Xd)(u.VO,t.tree,a,e,i.provider.publicKey)).postInstructions(t.notes.length<r.D4?[await i.methods.attachNote().accounts((0,r.J3)(u.VO,t.tree,a,l,i.provider.publicKey)).instruction()]:[]).rpc(),s&&s(),C(void 0),Z(void 0),E(void 0),K(void 0),g(!1),h.Am.success("Note created!")}catch(n){h.Am.error(n.toString())}finally{F(!1)}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"w-64 bg-base-100 hover:bg-base-200 transition-all border-2 border-base-200 rounded-xl shadow-inner hover:shadow-xl p-6 m-3 flex flex-col",onClick:()=>g(!0),children:(0,l.jsxs)("div",{className:"m-auto",children:[(0,l.jsx)(p.QZL,{className:"w-20 h-20 m-auto"}),(0,l.jsx)("div",{className:"text-2xl text-center",children:"Create note"})]})}),(0,l.jsx)("div",{className:"modal ".concat(f?"modal-open":""),children:(0,l.jsxs)("div",{className:"modal-box flex flex-col p-5 gap-5 max-w-3xl",children:[(0,l.jsx)("div",{className:"btn btn-sm btn-circle fixed right-2 top-2 absolute",onClick:()=>g(!1),children:"✕"}),(0,l.jsx)("div",{className:"text-2xl font-bold",children:"Create a note"}),(0,l.jsxs)("div",{className:"bg-base-200 p-3 rounded-xl shadow-inner",children:[(0,l.jsx)("div",{className:"text-lg font-bold",children:"Title"}),(0,l.jsx)("div",{className:"text-sm",children:"The title of this note."}),(0,l.jsx)("input",{className:"input input-bordered w-full",placeholder:"Dippies Index Protocol",onChange:V}),(0,l.jsxs)("div",{className:"text-end justify-end",children:[(null==w?void 0:w.length)||0," / ",r.cG]})]}),(0,l.jsxs)("div",{className:"bg-base-200 p-3 rounded-xl shadow-inner",children:[(0,l.jsx)("div",{className:"text-lg font-bold",children:"Website"}),(0,l.jsx)("div",{className:"text-sm",children:"Website the note points to."}),(0,l.jsx)("input",{className:"input input-bordered w-full",placeholder:"https://...",onChange:I})]}),(0,l.jsxs)("div",{className:"bg-base-200 p-3 rounded-xl shadow-inner",children:[(0,l.jsx)("div",{className:"text-lg font-bold",children:"Cover image"}),T?(0,l.jsx)("img",{src:T,className:"w-32 h-32 rounded m-auto"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"text-sm",children:"The cover image of the note."}),(0,l.jsx)("input",{className:"input input-bordered w-full",placeholder:"https://...",onChange:U}),(0,l.jsxs)("div",{...B(),className:"border-dashed border-neutral-content border rounded-lg p-4 my-2",children:[(0,l.jsx)("input",{...P()}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(p.BYk,{className:"mx-auto w-12 h-12"}),R?(0,l.jsx)("p",{children:"Drop the files here ..."}):(0,l.jsx)("p",{children:"Click or drag your image here to upload it to Arweave"})]})]})]})]}),(0,l.jsxs)("div",{className:"bg-base-200 p-3 rounded-xl shadow-inner",children:[(0,l.jsx)("div",{className:"text-lg font-bold",children:"Description"}),(0,l.jsx)("div",{className:"text-sm",children:"A short description."}),(0,l.jsx)("input",{className:"input input-bordered w-full",placeholder:"This project is about...",onChange:z})]}),(0,l.jsx)("div",{className:"btn btn-primary ".concat(k&&(S||T)&&D?"":"btn-disabled"," ").concat(O?"btn-disabled loading":""),onClick:X,children:"Create a note"})]})})]})},y=s(41664),k=s.n(y),C=s(89583),S=s(45332),Z=s(75396),T=e=>{let{node:t}=e,{forest:s}=(0,m.Z)(),{map:a}=(0,Z.Z)(),n=s?null==a?void 0:a.get(s.voteMint.toString()):void 0;return(0,l.jsxs)("div",{className:"w-64 bg-base-200 rounded-xl shadow-xl p-3 m-3",children:[(0,l.jsx)("div",{className:"font-lg font-bold",children:t.tags[t.tags.length-1]}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,l.jsx)("div",{children:"Total stake:"}),(0,l.jsx)("div",{children:n?(0,S.Bw)(t.stake,n.decimals).toFixed(2):"???"})]}),(0,l.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,l.jsx)("div",{children:"Children:"}),(0,l.jsx)("div",{children:t.children.length})]}),(0,l.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,l.jsx)("div",{children:"Notes:"}),(0,l.jsx)("div",{children:t.notes.length})]}),(0,l.jsx)(k(),{href:"/dip/node/".concat((0,r.vh)(t.tree,t.parent,t.tags[t.tags.length-1]).toString()),children:(0,l.jsxs)("div",{className:"underline font-bold flex justify-center gap-2",children:[(0,l.jsx)("div",{children:"See this node"}),(0,l.jsx)(C.CkN,{className:"w-4 h-4 my-auto"})]})})]})]})},K=s(13550),M=s(90482),A=s(2585),D=s(61253);let E=e=>{let{program:t,stakes:s,fetchStake:l}=(0,m.Z)(),[a,n]=(0,d.useState)(),i=()=>{if(!t||!t.provider.publicKey||!e)return;let a=(0,r.QX)(e,t.provider.publicKey),i=s[a.toString()];i?n(i):l(a)};return(0,d.useEffect)(()=>{i()},[s,e]),a};var O=s(3247),F=s(83613),_=s(44777),B=s(43651),P=e=>{let{note:t,onUpdate:s}=e,a=(0,c.O)(),{connection:n}=(0,o.R)(),i=(0,v.Z)(),{account:f,refresh:p}=function(e){let t=(0,B.z)(),{token:s}=(0,O.Z)(e),{connection:l}=(0,o.R)(),[a,n]=(0,d.useState)(),i=a&&s?a.amount.toLocaleString("fullwide",{maximumFractionDigits:s.decimals}):0,r=async()=>{if(l&&(null==t?void 0:t.publicKey))try{let s=await (0,F.D0)(l,(0,_.MO)(e,t.publicKey));n(s)}catch(a){}};return(0,d.useEffect)(()=>{r()},[null==t?void 0:t.publicKey,e]),{account:a,refresh:r,value:i}}(u.yC),{program:j,forest:g}=(0,m.Z)(),{token:b}=(0,O.Z)(null==g?void 0:g.voteMint),[N,w]=(0,d.useState)(!1),[y,k]=(0,d.useState)(),C=E(a.publicKey?(0,r.El)(t.tree,t.id):void 0),Z=async e=>{if(!i||!a.publicKey||!j||!g||!y)return;let l=new x.Transaction;C||l.add(await j.methods.createStake().accounts((0,r.Dc)(u.VO,g.voteMint,t.tree,t.parent,(0,r.El)(t.tree,t.id),a.publicKey)).instruction());let d=e?new K.BN(new M.Z(y).mul(10**((null==b?void 0:b.decimals)||6)).toString()):new K.BN(new M.Z(y).mul(10**((null==b?void 0:b.decimals)||6)).toString()).neg();l.add(await j.methods.updateStake(d).accounts((0,r.Dc)(u.VO,g.voteMint,t.tree,t.parent,(0,r.El)(t.tree,t.id),a.publicKey)).instruction());try{await n.confirmTransaction(await a.sendTransaction(l,n,{skipPreflight:!0})),p(),w(!1),k(void 0),s&&s()}catch(c){h.ZP.error("Failed udating stake: ".concat(c))}};return console.log(C,f,y),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"btn w-full justify-around",onClick:()=>w(!0),children:[(0,l.jsx)("div",{children:"Manage stake"}),(0,l.jsx)(A.L9c,{})]}),(0,l.jsx)("div",{className:"modal ".concat(N?"modal-open":""),children:(0,l.jsxs)("div",{className:"modal-box flex flex-col gap-5",children:[(0,l.jsx)("div",{className:"btn btn-sm btn-circle fixed right-2 top-2 absolute",onClick:()=>w(!1),children:"✕"}),(0,l.jsx)("div",{className:"text-2xl font-bold",children:"Manage stake"}),(0,l.jsxs)("div",{className:"flex flex-col gap-3 justify-between bg-base-200 shadow-inner rounded-lg p-3",children:[(0,l.jsxs)("div",{className:"my-auto text-lg flex flex-row justify-between",children:[(0,l.jsx)("div",{children:"Your balance:"}),(0,l.jsx)("div",{children:g&&f?(0,l.jsx)(D.s,{mint:g.voteMint,amount:new K.BN(f.amount.toString())}):"???"})]}),(0,l.jsxs)("div",{className:"my-auto text-lg flex flex-row justify-between",children:[(0,l.jsx)("div",{children:"Your stake:"}),(0,l.jsx)("div",{onClick:()=>k(C?(0,S.Bw)(C.stake,(null==b?void 0:b.decimals)||6).toNumber():0),children:g&&C?(0,l.jsx)(D.s,{mint:g.voteMint,amount:C.stake}):"???"})]}),(0,l.jsxs)("div",{className:"my-auto text-lg flex flex-row justify-between",children:[(0,l.jsx)("div",{children:"Total stake:"}),(0,l.jsx)("div",{children:g&&C?(0,l.jsx)(D.s,{mint:g.voteMint,amount:t.stake}):"???"})]}),(0,l.jsxs)("div",{className:"flex flex-row gap-3 justify-center",children:[(0,l.jsx)("input",{className:"input w-full",type:"number",onChange:e=>k(Number(e.target.value))}),(0,l.jsx)("div",{className:"btn btn-error btn-outline text-4xl ".concat(!C||0>=(0,S.Bw)(C.stake,(null==b?void 0:b.decimals)||6).toNumber()?"btn-disabled":""),onClick:()=>Z(!1),children:"-"}),(0,l.jsx)("div",{className:"btn btn-success btn-outline text-4xl ".concat(!y||!f||0>(0,S.Bw)(f.amount.toString(),(null==b?void 0:b.decimals)||6).toNumber()?"btn-disabled":""),onClick:()=>Z(!0),children:"+"})]})]})]})})]})},R=e=>{let{note:t}=e,s=(0,c.O)(),{forest:a}=(0,m.Z)();return(0,l.jsxs)("div",{className:"w-64 bg-base-200 rounded-xl shadow-xl m-3 flex flex-col gap-2",children:[(0,l.jsx)("div",{children:(0,l.jsx)("img",{className:"w-full rounded-t-xl",src:t.image,alt:t.description})}),(0,l.jsx)("div",{className:"p-3 pt-0",children:(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,l.jsx)("div",{className:"divider text-lg font-bold",children:t.description}),(0,l.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,l.jsx)("div",{className:"font-bold my-auto",children:"Total stake:"}),(0,l.jsx)("div",{className:"flex flex- gap-1",children:(0,l.jsx)("div",{className:"my-auto font-bold",children:a?(0,l.jsx)(D.s,{mint:a.voteMint,amount:t.stake}):"??"})})]}),s.publicKey?(0,l.jsx)(P,{note:t}):null,(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-bold",children:"Tags:"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:t.tags.map(e=>(0,l.jsx)("div",{className:"badge badge-sm badge-primary",children:e}))})]}),(0,l.jsx)("a",{href:t.website,children:(0,l.jsxs)("div",{className:"underline font-bold flex justify-center gap-2",children:[(0,l.jsx)("div",{children:"See this webpage"}),(0,l.jsx)(C.CkN,{className:"w-4 h-4 my-auto"})]})})]})})]})};let V=e=>{let{nodes:t,fetchNode:s}=(0,m.Z)(),l=(0,d.useMemo)(()=>{if(console.log("memo node",e),!e)return;let l=t[e.toString()];if(l)return l;s(e)},[e,t]);return l},I=e=>{let{notes:t,fetchNote:s}=(0,m.Z)(),l=(0,d.useMemo)(()=>{if(console.log("memo note",null==e?void 0:e.toString()),!e)return;let l=t[e.toString()];if(console.log(l),l)return l;s(e)},[e,t]);return l};var U=e=>{let{nodeKey:t}=e,{forest:s}=(0,m.Z)(),a=V(t),n=V(null==a?void 0:a.parent),d=Array(r.D).fill(0).map((e,t)=>V(null==a?void 0:a.children[t])),c=Array(r.D4).fill(0).map((e,t)=>I(null==a?void 0:a.notes[t]));return(0,l.jsxs)("div",{className:"flex flex-col w-lg justify-center p-5",children:[(0,l.jsx)(k(),{href:a&&!a.parent.equals(x.PublicKey.default)?"/dip/node/".concat(null==a?void 0:a.parent):"/dip/trees",children:(0,l.jsx)("div",{className:"btn btn-ghost",children:(0,l.jsx)(i.And,{className:"w-8 h-8"})})}),a?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"divider text-2xl font-bold ",children:a.tags[a.tags.length-1]}),(0,l.jsxs)("div",{className:"flex flex-wrap mx-auto gap-2",children:[(0,l.jsx)("span",{children:"Total stake:"}),s?(0,l.jsx)(D.s,{mint:s.voteMint,amount:a.stake}):"???"]}),(0,l.jsxs)("div",{className:"flex flex-wrap mx-auto gap-2",children:[(0,l.jsx)("div",{className:"text-xl",children:"Tags:"}),a.tags.map(e=>(0,l.jsx)("div",{className:"badge badge-primary h-full m-1",children:e},e))]}),c?(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,l.jsx)("div",{className:"divider text-lg",children:"Notes"}),(0,l.jsx)("div",{className:"flex flex-wrap mx-auto",children:0===a.children.length?c.map((e,t)=>e?(0,l.jsx)(R,{note:e},e.tags.join().toString()):(0,l.jsx)(w,{node:a},"create-note-".concat(t))):(0,l.jsx)("div",{className:"font-bold",children:"Can't create notes on nodes with children"})})]}):null,d?(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,l.jsx)("div",{className:"divider text-lg",children:"Children"}),(0,l.jsx)("div",{className:"flex flex-wrap mx-auto",children:d.sort((e,t)=>e.stake.gt(t.stake)?-1:1).map((e,t)=>e?(0,l.jsx)(T,{node:e},e.tags.join()):(0,l.jsx)(f,{node:a},"create-node-".concat(t)))})]}):null,n?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"divider text-lg",children:"Parent"}),(0,l.jsx)("div",{className:"flex flex-wrap mx-auto",children:(0,l.jsx)(T,{node:n})})]}):null]}):null]})},z=s(11163);let X=()=>{let e=(0,z.useRouter)(),{key:t}=e.query,s=(0,d.useMemo)(()=>{if(t||"string"==typeof t)try{return new x.PublicKey(t)}catch(e){}},[e]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n(),{children:[(0,l.jsx)("title",{children:"Dippies Club - Dippies Index Protocol"}),(0,l.jsx)("meta",{name:"description",content:"A path forward"}),(0,l.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,l.jsx)("div",{className:"mt-24",children:s?(0,l.jsx)(U,{nodeKey:s}):null})]})};var L=X},28289:function(){},52215:function(){}},function(e){e.O(0,[445,980,25,8,774,888,179],function(){return e(e.s=88222)}),_N_E=e.O()}]);